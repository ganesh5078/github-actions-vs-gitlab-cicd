name: Deploy gh-pages

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
    
    - name: Prepare Deployment Directory
      # GitHub Pages looks for index.html in the root, so we stage the file correctly.
      run: |
        # 1. Create a temporary deployment directory
        mkdir _site
        
        # 2. Copy the HTML file into the directory, renaming it to index.html
        cp $GITHUB_WORKSPACE/github_vs_gitlab_cicd.html _site/index.html
        
        # 3. Add .nojekyll file to ensure GitHub Pages serves the HTML as-is
        touch _site/.nojekyll
    
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        # The directory containing the index.html file to deploy
        publish_dir: _site
        # Forces a clean deployment, deleting all previous files on the gh-pages branch
        force_orphan: true
        # Ensures no Jekyll processing interferes with the SPA
        enable_jekyll: false

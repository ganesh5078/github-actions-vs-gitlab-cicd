name: Deploy gh-pages

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
    
    - name: Debug: List Files
      # This step will print all files in the repository root to the log. 
      # You can verify the exact file name here if the next step fails.
      run: ls -F $GITHUB_WORKSPACE
    
    - name: Prepare Deployment Directory
      run: |
        # Define the exact file name. Verify this matches what you see in the 'Debug' step.
        INFOGRAPHIC_FILE="github_vs_gitlab_cicd_infographic.html"
        DEPLOY_DIR="_site"
        
        # 1. Create a temporary deployment directory
        mkdir $DEPLOY_DIR
        
        # 2. Use the absolute path to copy the HTML file, renaming it to index.html
        # The $GITHUB_WORKSPACE variable guarantees we look in the repository root.
        cp "$GITHUB_WORKSPACE/$INFOGRAPHIC_FILE" "$DEPLOY_DIR/index.html"
        
        # 3. Add .nojekyll file to ensure GitHub Pages serves the HTML as-is
        touch "$DEPLOY_DIR/.nojekyll"
    
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        # The directory containing the index.html file to deploy
        publish_dir: _site
        # Forces a clean deployment, deleting all previous files on the gh-pages branch
        force_orphan: true
        # Ensures no Jekyll processing interferes with the SPA
        enable_jekyll: false
